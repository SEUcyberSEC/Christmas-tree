<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Â±àÊÖïÂéüÂú£ËØûÂø´‰πêÔºÅ</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000005;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: white;
            font-family: Arial, sans-serif;
        }
        canvas { display: block; }

        /* Èü≥‰πêÊåâÈíÆÊ†∑Âºè */
        #music-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 20px;
            user-select: none;
            transition: all 0.3s;
        }
        #music-control.playing {
            animation: rotate 3s linear infinite;
            background: rgba(255, 50, 50, 0.5);
        }
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

<!-- Èü≥‰πêÊéßÂà∂ÊåâÈíÆ -->
<div id="music-control">üéµ</div>

<!-- Èü≥È¢ëÊ†áÁ≠æ -->
<!-- ‰Ω†ÂèØ‰ª•Â∞Ü src Êîπ‰∏∫Êú¨Âú∞ÁöÑÊñá‰ª∂ÂêçÔºåÂ¶Ç src="bgm.mp3" -->
<audio id="bgm" loop>
    <source src="we-wish-you-a-merry-christmas.mp3" type="audio/mpeg">
    ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅÈü≥È¢ëÊí≠Êîæ„ÄÇ
</audio>

<canvas id="canvas"></canvas>

<script>
    // --- Èü≥‰πêÊéßÂà∂ÈÄªËæë ---
    const bgm = document.getElementById('bgm');
    const musicBtn = document.getElementById('music-control');
    let isPlaying = false;

    function toggleMusic() {
        if (isPlaying) {
            bgm.pause();
            musicBtn.classList.remove('playing');
        } else {
            bgm.play().catch(err => console.log("Á≠âÂæÖÁî®Êà∑‰∫§‰∫íÂêéÊí≠Êîæ"));
            musicBtn.classList.add('playing');
        }
        isPlaying = !isPlaying;
    }

    musicBtn.addEventListener('click', (e) => {
        e.stopPropagation(); // Èò≤Ê≠¢Ëß¶ÂèëÈ°µÈù¢ÁöÑÁÇπÂáª‰∫ã‰ª∂
        toggleMusic();
    });

    // Ëá™Âä®Êí≠ÊîæÁ†¥Ëß£ÔºöÁî®Êà∑Á¨¨‰∏ÄÊ¨°ÁÇπÂáªÈ°µÈù¢‰ªª‰ΩïÂú∞ÊñπÊó∂ÂºÄÂßãÊí≠Êîæ
    window.addEventListener('click', () => {
        if (!isPlaying) {
            toggleMusic();
        }
    }, { once: true }); // Âè™Ëß¶Âèë‰∏ÄÊ¨°


    // --- ‰ª•‰∏ãÊòØÂéüÊúâÁöÑ 3D Âú£ËØûÊ†ë‰ª£Á†Å (ÂÆåÂÖ®‰øùÁïôËßÜËßâÁ≤æÂçé) ---
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const dpr = window.devicePixelRatio || 1;
    let WIDTH, HEIGHT;

    function resize() {
        WIDTH = window.innerWidth;
        HEIGHT = window.innerHeight;
        canvas.width = WIDTH * dpr;
        canvas.height = HEIGHT * dpr;
        canvas.style.width = WIDTH + 'px';
        canvas.style.height = HEIGHT + 'px';
        ctx.scale(dpr, dpr);
    }
    window.addEventListener('resize', resize);
    resize();

    const COLORS = {
        BLACK: 'rgb(0, 0, 5)',
        GOLD: {r: 255, g: 223, b: 0, str: 'rgb(255, 223, 0)'},
        WHITE: {r: 255, g: 255, b: 255, str: 'rgb(255, 255, 255)'},
        RED_LIGHT: {r: 255, g: 50, b: 50},
        CYAN_LIGHT: {r: 50, g: 255, b: 255}
    };

    const imgUrls = ['1.jpg', '2.jpg', '3.jpg', '4.jpg'];
    const images = [];
    imgUrls.forEach((url, i) => {
        const img = new Image();
        img.src = url;
        images[i] = img;
    });

    class Point3D {
        constructor(x, y, z, color, size, type = "leaf", imgIdx = null) {
            this.x = x; this.y = y; this.z = z;
            this.base_x = x; this.base_z = z;
            this.color = color;
            this.size = size;
            this.type = type;
            this.imgIdx = imgIdx;
            this.blink_offset = Math.random() * 100;
        }
        project(angle, fov = 350, viewer_distance = 450) {
            const cos_a = Math.cos(angle);
            const sin_a = Math.sin(angle);
            let rot_x = this.base_x * cos_a - this.base_z * sin_a;
            let rot_z = this.base_x * sin_a + this.base_z * cos_a;
            const depth = viewer_distance + rot_z;
            if (depth < 1) return null;
            const scale = fov / depth;
            return {
                x: rot_x * scale + WIDTH / 2,
                y: this.y * scale + HEIGHT / 2 + 50,
                scale: scale,
                z_depth: rot_z
            };
        }
    }

    const particles = [];
    const layers = 80;
    for (let i = 0; i < layers; i++) {
        let y = -200 + i * 5;
        let radius = i * 2.5;
        let count = Math.floor(radius * 1.5) + 5;
        for (let j = 0; j < count; j++) {
            let p_angle = (j / count) * Math.PI * 2 + (i * 0.5);
            let r_rand = radius * (0.8 + Math.random() * 0.4);
            let px = Math.cos(p_angle) * r_rand;
            let pz = Math.sin(p_angle) * r_rand;
            let color = { r: 34, g: 139 + Math.floor(Math.random() * 50), b: 34 };
            let type = "leaf";
            let size = 2;
            if (Math.random() < 0.08) {
                type = "light"; size = 4;
                const choices = [COLORS.RED_LIGHT, COLORS.GOLD, COLORS.CYAN_LIGHT];
                color = choices[Math.floor(Math.random() * choices.length)];
            }
            particles.push(new Point3D(px, y, pz, color, size, type));
        }
    }
    for (let i = 0; i < 50; i++) {
        particles.push(new Point3D((Math.random()-0.5)*20, -220+(Math.random()-0.5)*20, (Math.random()-0.5)*20, COLORS.GOLD, 3, "star"));
    }
    const imagePoints = [];
    const imgRadius = 130;
    const imgPositions = [{x:0,z:1}, {x:1,z:0}, {x:0,z:-1}, {x:-1,z:0}];
    for (let i = 0; i < 4; i++) {
        imagePoints.push(new Point3D(imgPositions[i].x * imgRadius, -280, imgPositions[i].z * imgRadius, null, 1, "image", i));
    }
    const snowflakes = [];
    for (let i = 0; i < 200; i++) {
        snowflakes.push(new Point3D((Math.random()-0.5)*800, (Math.random()-0.5)*800, (Math.random()-0.5)*400, COLORS.WHITE, Math.random()*2+1, "snow"));
    }

    let angle = 0, time = 0;
    function animate() {
        ctx.fillStyle = COLORS.BLACK;
        ctx.fillRect(0, 0, WIDTH, HEIGHT);
        angle += 0.012; time += 1;
        let to_draw = [];
        [...particles, ...imagePoints].forEach(p => {
            const proj = p.project(angle);
            if (proj) to_draw.push({ ...proj, p });
        });
        snowflakes.forEach(s => {
            s.y += 1.5; if (s.y > 400) s.y = -400;
            const proj = s.project(0);
            if (proj) to_draw.push({ ...proj, p: s });
        });
        to_draw.sort((a, b) => b.z_depth - a.z_depth);

        to_draw.forEach(item => {
            const { p, x, y, scale } = item;
            const size = Math.max(1, p.size * scale);
            if (p.type === "leaf") {
                let df = Math.max(0.1, Math.min(1, scale * 0.8));
                ctx.fillStyle = `rgb(${p.color.r * df}, ${p.color.g * df}, ${p.color.b * df})`;
                ctx.beginPath(); ctx.arc(x, y, size, 0, Math.PI*2); ctx.fill();
            } else if (p.type === "light") {
                let blink = Math.sin(time * 0.05 + p.blink_offset);
                if (blink > 0) {
                    ctx.save();
                    ctx.globalCompositeOperation = 'lighter';
                    ctx.fillStyle = `rgb(${p.color.r},${p.color.g},${p.color.b})`;
                    ctx.beginPath(); ctx.arc(x, y, size, 0, Math.PI*2); ctx.fill();
                    ctx.restore();
                } else {
                    ctx.fillStyle = '#333';
                    ctx.beginPath(); ctx.arc(x, y, size, 0, Math.PI*2); ctx.fill();
                }
            } else if (p.type === "star") {
                ctx.save();
                ctx.globalCompositeOperation = 'lighter';
                ctx.fillStyle = COLORS.GOLD.str;
                ctx.beginPath(); ctx.arc(x, y, size+1, 0, Math.PI*2); ctx.fill();
                ctx.restore();
            } else if (p.type === "image") {
                const img = images[p.imgIdx];
                if (img && img.complete) {
                    const drawW = 140 * scale;
                    const drawH = (img.naturalHeight / img.naturalWidth) * drawW;
                    ctx.save();
                    ctx.shadowBlur = 15; ctx.shadowColor = "white";
                    ctx.strokeStyle = "white"; ctx.lineWidth = 2;
                    ctx.drawImage(img, x - drawW/2, y - drawH/2, drawW, drawH);
                    ctx.strokeRect(x - drawW/2, y - drawH/2, drawW, drawH);
                    ctx.restore();
                }
            } else if (p.type === "snow") {
                ctx.fillStyle = "white";
                ctx.beginPath(); ctx.arc(x, y, size, 0, Math.PI*2); ctx.fill();
            }
        });

        ctx.font = "bold 40px Arial"; ctx.textAlign = "center";
        ctx.fillStyle = "rgba(150, 0, 0, 0.5)";
        ctx.fillText("Merry Christmas", WIDTH/2 + 2, HEIGHT - 60 + 2);
        ctx.fillStyle = "rgb(255, 50, 50)";
        ctx.fillText("Merry Christmas", WIDTH/2, HEIGHT - 60);

        requestAnimationFrame(animate);
    }
    animate();
</script>
</body>
</html>